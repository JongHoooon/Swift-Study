# 서브크스립트

* 클래스, 구조체, 열거형에는 컬렉션, 리스트, 시퀀스 등 타입이 요소에 접근하는 단축 문법인 서브스크립트(Subscript)를 정의할 수 있다.
* 서브스크립트는 별도의 설정자(Setter) 또는 접근자(Getter)등의 메서드를 구현하지 않아도 인덱스를 통해 값을 설정하거나 가져올수 있다.
* 서브스크립트 중복 정의(Subscript Overloading): 서브스크립트를 여러 개 구현해도 외부에서 서브스크립트를 사용할 때는 서브스크립트를 사용할 때 전달한 값의 타입을 유추하여 적절한 서브스크립트를 선택하여 실행한다.
* 여러 매개변수를 갖는 경우도 있다.

<br><br>

## 1. 서브스크립트 문법

* 서브스크립트는 인스턴스의 이름 뒤에 대괄호로 감싼 값을 싸줌으로써 인스턴스 내부의 특정 값에 접근할 수 있다.
* subscript 키워드를 사용하여 정의하낟.
  * 인스턴스 메서드와 비슷하게 매개변수의 개수, 타입, 반환 타입 등을 지정하며, 읽고 쓰기가 가능하도록 구현하거나 읽기 전용으로만 구현할 수 있다.
  * 서브스크립트를 정의하는 코드는 각 타입의 구현부 또는 타입의 익스텐션 구현부에 위치해야 한다.

```swift
subscript(index:: Int) -> Int {
    get {
        // 적절한 서브스크립트 결괏값 반환
    }
    
    set(newValue) {
        // 적절한 설정자 역할 수행
    }
}
```

* 설정자의 newValue의 타입은 서브스크립트의 반환 타입과 동일하다.
  * 매개변수를 따로 명시해주지 않으면 암시적 전달자 newValue 사용 가능
* 읽기 전용 프로퍼티를 구현할 때는 get이나 set 키워드를 사용하지 않고 적절한 값만 반환해주는 형태로 구현해도 된다.

<br>

* 읽기 전용 서브스크립트 정의
  
```swift
subscript(Index: Int) -> Int {
    get {
        // 적절한 서브스크립트 값 반환
    }
}

subscript(Index: Int) -> Int {
    // 적절한 서브스크립트 결괏값 반환
}
```


<br><br>

## 2. 서브스크립트 구현

* 서브스크립트는 자신이 가지는 시퀀스나 컬렉션, 리스트 등의 요소를 반환하고 설정할 때 주로 사용한다.
* 함수 처럼 서브스크립트는 여러 개의 매개변수를 가질 수 있고, 매개변수 기본값을 가질 수 있다.
* 입출력 매개변수(in-out parameters)는 가질 수 없다.

```swift
class School {
    var number: Int = 0
    var students: [Student] = [Student]()
    
    func addStudent(name: String) {
        let student: Student = Student(name: name, number: self.number)
        self.students.append(student)
        self.number += 1
    }
    
    func addStudents(names: String...) {
        for name in names {
            self.addStudent(name: name)
        }
    }
    
    subscript(index: Int = 0) -> Student? {
        if index < self.number {
            return self.students[index]
        }
        return nil
    }
}

let highSchool: School = School()
highSchool.addStudents(names: "MiJeong", "JiYoung", "SeongUk", "MoonDuk")

let aStudent: Student? = highSchool[1]
print("\(aStudent?.number) \(aStudent?.name)")      // Optional(1) Optional("JiYoung")
print(highSchool[]?.name)   // 매개변수 기본값 사용: Optional("MiJeong")


// 학생의 번호를 전달인자로 전달받아 자신의 students 프로퍼티으 인덱스에 맞는 Student 인스턴스를 반환한다.
```

<br><br>

## 3. 복수 서브스크립트

하나의 타입이 여러 개의 서브스크립트를 가질 수도 있다.

```swift
struct Student {
    var name: String
    var number: Int
}

class School {
    
    var number: Int = 0
    var students: [Student] = [Student]()
    
    func addStudent(name: String) {
        let student: Student = Student(name: name, number: self.number)
        self.students.append(student)
        self.number += 1
    }
    
    func addStudents(names: String...) {
        for name in names {
            self.addStudent(name: name)
        }
    }

    subscript(index: Int) -> Student? {     // 첫 번째 서브스크립트
        get {
            if index < self.number {
                return self.students[index]
            }
            return nil
        }
        
        set {
            guard var newStudent: Student = newValue else { return }
        
            var number: Int = index
            
            if index > self.number {
                number = self.number
                self.number += 1
            }
            
            newStudent.number = number
            self.students[number] = newStudent
        }
    }
    
    subscript(name: String) -> Int? {       // 두 번째 서브스크립트
        get {
            return self.students.filter{ $0.name == name }.first?.number
        }
        
        set {
            guard var number: Int = newValue else { return }
            
            if number > self.number {
                number = self.number
                self.number += 1
            }
            
            let newStudent: Student = Student(name: name, number: number)
            self.students[number] = newStudent
        }
    }
    
    subscript(name: String, number: Int) -> Student? {      // 세 번째 서브스크립트
        return self.students.filter{ $0.name == name && $0.number == number }.first
    }
}


let highSchool: School = School()
highSchool.addStudents(names: "MiJeong", "JuHyun", "JiYoung", "SeongUk", "MoonDuk")

let aStudent: Student? = highSchool[1]
print("\(aStudent?.number) \(aStudent?.name)")      // Optional(1) Optional("JiYoung")

print(highSchool["MiJeong"])     // Optional(0)
print(highSchool["DongJin"])     // nil

highSchool[0] = Student(name: "HongEui", number: 0)
highSchool["MangGu"] = 1

print(highSchool["JuHyun"])         // nil
print(highSchool["MangGu"])         // Optional(1)
print(highSchool["SeongUk", 3])     // Optional(Student(name: "SeongUk", number: 3))
print(highSchool["HeeJin", 3])      // nil
```

<br><br>

## 4. 타입 서브스크립트

* 인스턴스가 아니라 타입 자체에서 사용할 수 있는 서브스크립트이다.
* static 키워드를 사용 

```swift
enum School: Int {
    case elementary = 1, middle, high, university
    
    static subscript(level: Int) -> School? {
        return Self(rawValue: level)
        // return School(rawValue: level)과 같은 표현
    }
}

let school: School? = School[2]
print(school)       // Optional(School.middle)
```

