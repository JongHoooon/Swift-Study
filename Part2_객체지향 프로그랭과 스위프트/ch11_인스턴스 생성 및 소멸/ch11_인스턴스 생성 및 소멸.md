# 인스턴스 생성 및 소멸

## 1. 인스턴스 생성

* 이니셜라이져(Initializer)를 정의하면 초기화 과정을 직접 구현할 수 있다.
* 스위프트의 이니셜라이저는 반환 값이 없다.
* init 키워드 사용
* init 메서드는 클래스, 구조체, 열거형 등의 구형부 또는 익스텐션 구변부에 위치
  * 다만 클래스의 지정 이니셜라이저는 익스텐션에서 구형 불가능

```swift
class SomeClass {
    init() {
        // 초기화활 때 필요한 코드
    }
}

struct SomeStruct {
    init() {
        // 초기화할 때 필요한 코드
    }
}

enum SomeEnum {
    case someCase
    
    init() {
        // 열거형은 초기화할 때 반드시 case중 하나가 되어야 합니다.
        self = .someCase
    }
}
```

</br>

### 1.1. 프로퍼티 기본값 

* 구조체와 클래스의 인스턴스는 처음 생성할 때 옵셔널 저장 프로퍼티를 제외하고 모든 프로퍼티에 적잘한 **초깃값(Initial Value)**을 할당해야 한다.
* 이니셜라이저가 실행 될 때 저장 프로퍼티에 적절한 초깃값을 할당할 수 있다.
* 초기화 후에 값이 확정되지 않은 저장 프로퍼티는 존재할 수 없다.
* 프로퍼티 기본값(Default Value)을 할당하면 이니셜라이저에서 따로 초깃값을 할당하지 않아도 된다.
*  이니셜라이저, 프로퍼티 기본값을 통해 저장 프로퍼티가 초기화될 때는 프로퍼티 감시자 메서드가 호출되지 않는다.

```swift
struct Area {
    var squaerMaster: Double
    
    init() {
        squaerMaster = 0.0  // squareMeter의 초깃값 할당
    }
}

let room:Area = Area()
print(room.squaerMaster)
```

</br>

### 이니셜라이저 매개변수
* 이니셜라이저도 인스턴스를 초기화하는 과정에 필요한 값을 전달받을 수 있다.

```swift
struct Area {
    var squaerMaster: Double
    
    init(fromPy py: Double) {                   // 첫 번째 이니셜라이저
        squaerMaster = py * 3.3058
    }
    
    init(fromSquareMeter squareMeter: Double) { // 두 번째 이니셜라이저
        self.squaerMaster = squareMeter
    }
    
    init(value: Double) {                       // 세 번째 이니셜라이저
        squaerMaster = value
    }
    
    init(_ value: Double) {                     // 네 번째 이니셜라이저
        squaerMaster = value
    }
}

let roomOne: Area = Area(fromPy: 15.0)
print(roomOne.squaerMaster) // 49.587

let roomTwo:Area = Area(fromSquareMeter: 33.06)
print(roomTwo.squaerMaster) // 33.06

let roomThree: Area = Area(value: 30.0)
let roomFour: Area = Area(55.0)
```

</br>

### 1.3. 옵셔널 프로퍼티 타입

* 인스턴스가 사용되는 동안에 값을 꼭 갖지 않아도 되는 저장 프로퍼티를 옵셔널로 선언
* 초기화 과정에서 값을 할당해주지 않으면 자동으로 nil이 할당

```swift
class Person {
    var name: String
    var age: Int?
    
    init(name: String) {
        self.name = name
    }
}

let hoon: Person = Person(name: "hoon")
print(hoon.name)    // hoon
print(hoon.age)     // nil

hoon.name = "jong"
print(hoon.name)    // jong
```

</br>

### 1.4.상수 프로퍼티

* 상수로 선언된 저장 프로퍼티는 인스턴스를 초기화하는 과정에서만 값을 할당할 수 있다.
* 해당 클래스를 상속받은 자식클래스의 이니셜라이저에서는 부모클래스의 상수 프로퍼티 값을 초기화할 수 없다.

```swift
class Person {
    let name: String
    var age: Int?
    
    init(name: String) {
        self.name = name
    }
}

let hoon: Person = Person(name: "hoon")
print(hoon.name)    // hoon
print(hoon.age)     // nil

hoon.name = "jong"  // 오류 발생!!!
```

### 1.5. 기본 이니셜라이저와 멤버와이즈 이니셜라이저
* 저장 프로퍼티의 기본값이 모두 지정되어 있고, 사용자  정의 이니셜라이저가 정의되어 있지 않은 상태에서 사용된다.
* 구조체 - 프로퍼티의 이름으로 매개변수를 갖는 이니셜라이저인 멤버와이즈 이니셜라이저를 기본으로 제공
* 클래스 - 멤버와이즈 이니셜라이저 제공 X

```swift
struct Point {
    var x: Double = 0.0
    var y: Double = 0.0
}

struct Size {
    var width: Double = 0.0
    var height: Double = 0.0
}

let point: Point = Point(x: 0, y: 0)
let size: Size = Size(width: 50.0, height: 50.0)

// 구조체의 저장 프로퍼티에 기본값이 있는경우
// 필요한 매개변수만 사용하여 초기화하 수도 있습니다.
let somePoint: Point = Point()
let someSize: Size = Size(width: 50)
let anotherPoint: Point = Point(y: 100)
```

</br>

### 1.6. 초기화 위임
* 초기화 위임: 코드의 중복을 피하기 위해 이니셜라이저가 다른 이니셜라이저에게 일부 초기화를 위임
* 값 타입(구조체, 열거형) - 간단
* 상속을 지원하는 클래스는 간단한 초기화 위임도 할 수 없다.
* 이니셜라이저가 다른 이니셜라이저를 호출하려면 self.init을 사용하면된다.
* 초기화 위임을 하려면 최소 두 개 이상의 사용자 정의 이니셜라이저를 정의해야한다.
* 기본 이니셜라이저나 멤버와이즈 이니셜라이저를 지키고 싶다면 익스텐션을 사용하여 사용자 정의 이니셜라이저를 구현하면 된다.


```swift
enum Student {
    case elementary, middle, high
    case none
    // 사용자 정의 이니셜라이저가 있는 경우, init() 메서드를 구현해주어야 기본 이니셜라이저를
    // 사용할 수 있다.
    init() {
        self = .none
    }
    
    init(koreanAge: Int) {                  // 첫 번째 상용자 정의 이니셜라이저
        switch koreanAge {
        case 8...13:
            self = .elementary
        case 14...16:
            self = .middle
        case 17...19:
            self = .high
        default:
            self = .none
        }
    }
    
    init(bornAt: Int, currentYear: Int) {   // 두 번째 사용자 정의 이니셜라이저
        self.init(koreanAge: currentYear - bornAt + 1)
    }
}

var younger: Student = Student(koreanAge: 16)
print(younger)      // middle

younger = Student(bornAt: 1998, currentYear: 2016)
print(younger)      // high
```

</br>

### 1.7. 실패 가능한 이니셜라이저
* 실패 가능한 이니셜라이저(Fallable Initializer): 실패 가능성을 염두해 두고 인스턴스 초기화
* 클래스, 구조체, 열거형 등에 모두 정의 가능
* init? 키워드를 사용해 실패했을 때 nil을 반환


```swift
class Person {
    let name: String
    var age: Int?
    
    init?(name: String) {
        if name.isEmpty {
            return nil
        }
        self.name = name
    }
    
    init?(name: String, age: Int) {
        if name.isEmpty || age < 0 {
            return nil
        }
        self.name = name
        self.age = age
    }
}
let yagom: Person? = Person(name: "yagom", age: 99)

if let person: Person = yagom {
    print(person.name)
} else {
    print("Person wasn't initializeㅇ")
}
// yagom

let chope: Person? = Person(name: "chope", age: -10)

if let person: Person = chope {
    print(person.name)
} else {
    print("Person wasn't initialized")
}

// Person wasn't initialized
```

</br>

* 열거형에서 유용하다
  * 특정 case에 맞지 않는 값이 들어와 생성에 실패
  * rawValue로 초기화할 때, 잘못된 rawValue가 전달되어 들어온다면 열거형 인스턴스를 생성하지 못할 때 - rawValue를 통한 이니셜라이저는 기본적으로 실패 가능한 이니셜라이저로 제공

```swift
enum Student: String {
    case elementary = "초등학생", middle = "중학생", high = "고등학생"
    
    init?(koreanAge: Int) {
        switch koreanAge {
        case 8...13:
            self = .elementary
        case 14...16:
            self = .middle
        case 17...19:
            self = .high
        default:
            return nil
        }
    }
    
    init?(bornAt: Int, currentYear: Int) {
        self.init(koreanAge: currentYear - bornAt + 1)
    }
}


var younger: Student? = Student(koreanAge: 20)
print(younger)      // nil

younger = Student(bornAt: 2020, currentYear: 2016)
print(younger)      // nil

younger = Student(rawValue: "대학생")
print(younger)
print(younger)      // nil
younger = Student(rawValue: "고등학생")
print(younger)      // high
```

</br>

### 1.8. 함수를 사용한 프로퍼티 기본값 설정

* 사용자 정의 연산을 통해 저장 프로퍼티 기본값을 설정하고자 한다면 클로저나 함수를 사용하여 프로퍼티 기본값을 제공할 수 있다.
* 초기화할 때 함수나 클로저가 호출되면서 연산 결괏값을 프로퍼티 기본값으로 제공해준다. -> 반환 타입은 프로퍼티의 타입과 일치해야 한다.
* 클로저 내부에서는 인스턴스의 다른 프로퍼티를 사용하여 연살할 수 없다.
  * 클로저가 실행되는 시점은 초기화할 때 인스턴스의 다른 프로퍼티 값이 설정되기 전이다. 기본값이 있다고 해도 불가능
* 클로저 내부에서 self 프로퍼티도 사용, 인스턴스 메서드 호출 불가능
* 소괄호()
  * 클로저 뒤에 소괄호가 붙어 클로저를 실행한 결괏값은 프로퍼티의 기본값이 된다.
  * 소괄호가 없다면 프로퍼티의 기본값은 클로저 그 자체가 된다.

```swift
struct Student {
    var name: String?
    var number: Int?
}

class SchoolClass {
    var students: [Student] = {
        // 새로운 인스턴스를 생성하고 사용자 정의 연산을 통한 후 반환해준다.
        // 반환되는 값의 타입은 [Student] 타입이어야 한다.
        var arr: [Student] = [Student]()
        
        for num in 1...15 {
            var student: Student = Student(name: nil, number: num)
            arr.append(student)
        }
        return arr
    }()
}

let myClass: SchoolClass = SchoolClass()
print(myClass.students.count)   // 15
```

* iOS에서의 활용
  * iOS의 UI등을 구성할 때, UI컴포넌트를 클래스의 프로퍼티로 구현하고, UI 컴포넌트의 생성과 동시에 컴포넌트의 프로퍼티를 기본적으로 설정할 떄 유용하다.

