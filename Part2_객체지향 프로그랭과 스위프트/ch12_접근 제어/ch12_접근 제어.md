# 접근 제어


</br>

## 1.접근제어란
코드끼리 상호작용을 할 때 파일간 또는 모듈 간에 접근을 제한할 수 있는 기능이다. 접근제어를 통해 코드의 상세 구현은 숨기고 허용된 기능만 사용하는 인터페이스를 제공할 수 있다.

</br>

### 1.1. 접근제어의 필요성

* 객체지향 프로그래밍 패러다임에서 은닉화는 중요한 개념 중 하나이다. 이를 구현하기 위해 접근제어(Access Control)는  핵심 기능이다.

</br>

### 1.2. 모듈과 소스파일
* 스위프트의 접근제어는 모듈과 소스파일을 기반으로 설계되어있다.
* 모듈(Module)은 배포할 코드의 묶음 단위이다.
  * 하나의 프레임워크(Framework), 라이브러리(Library), 애플리케이션(Application)이 모듈 단위이다. 
  * import 키워드를 사용
* 소스파일(Source File)은 하나의 스위프트 소스코드 파일
  * 보통 파일 하나에 타입 하나만 정의한다.

</br>

## 2. 접근수준

* 접근수준(Access Level)키워드를 통해 접근제어 구현 가능
* 각 타입(클래스, 구조체, 열거형 등)에 특정 접근수준을 지정할 수 있다 
* 타입 내부 프로퍼티, 메서드, 이니셜라이저, 서브스크립트 각각에도 접근수준을 지정할 수 있다.

|접근수준     | 키워드 | 접근도 |   범위     |      비고        |
|-------------|--------|--------|-------------|-----------------|
|개방 접근수준| open   | 높음 | 모듈 외부까지 | 클래스에서만 사용|
|공개 접근수준|public |        |모듈 외부까지 |                  |
|내부 접근수준|internal|        |모듈 내부    |                 |
|파일외부비공개 </br> 접근수준| fileprivate| | 파일 내부     |                  |
|비공개 접근수준|private|낮음 | 기능 정의 내부 |                |

</br>

### 공개 접근수준 - public
* 자신이 구현된 소스파일, 소스파일이 속해 있는 모듈, 그 모듈을 가져다 쓴느 모듈등 모든 곳에서 사용 가능
* 스위프트의 기본 요소는 모두 공개 접근수준

</br>

### 개방 접근수준 - open
* 공개 접근수준(public) 이상으로 높은 접근수준이다
* 클래스와 클래스의 멤버에서만 사용 가능하다.
*  차이점
   * open 제외한 다른 접근수준의 클래스는 그 클래스가 정의된 모듈 안에서만 상속할 수 잇다.
   * open 제외한 다른 접근수준의 클래스 멤버는 해당 멤버가 정의된 모듈 안에서만 재정의할 수 있다.
   * open 클래스는 그 클래스가 정의된 모듈 밖의 다른 모듈에서도 상속할 수 있다.
   * open 클래스 멤버는 해당 멤버가 정의된 모듈 밖의 다른 모듈에서도 재정의할 수 있다.
 * open 수준의 명시는 그 클래스를 다른 모듈에서도 부모 클래스로 사용하겠다는 목적이다.


</br>

### 2.3. 내부 접근수준 - internal
* 기본적으로 모든 요소에 암묵적으로 지정하는 기본 접근 수준이다.
* 소스파일이 속해 있는 모듈 어디에서든 쓰일 수 있다.
* 그 모듈을 가져다 쓰는 외부 모듈에서는 접근할 수 없다.
* 모듈 내부에서 광역적으로 사용할 경우 사용

</br>

### 2.4. 파일외부비공개 접근수준 - fileprivate
* 그 요소가 구현된 소스파일 내부에서만 사용할 수 있다.
* 해당 소스파일 외부에서 값이 변경되거나 함수를 호출하면 부작용이 생길수 있는 경우 사용

### 2.5. 비공개 접근수준 - private
* 기능을 정의하고 구현한 범위 내에서만 사용할 수 있다.
* 같은 소스파일 안에 구현한 다른 타입이나 기능에서도 사용할 수 없다.

</br>

## 3. 접근제어 구현
* internal은 기본 접근수준이므로 생략가능

</br>

## 4. 접근제어 구현 참고사항
* 상위 요소보다 하위 요소가 더 높은 접근수준을 가 질 수 없다.
* 함수의 매개변수로 특정 접근수준이 부여된 타입이 전돨되거나 반환된다면, 그타입의 접근수준보다 함수의 접근수준이 높게 설정될 수 없다.


```swift
private class AClass {
    // 공개 접근수준을 부여해도 AClass의 접근수준이 비공개 접근수준이므로
    // 이 메서드의 접근수준도 비공개 접근수준으로 취급된다.
    public func someMethod() {
        // ...
    }
}

// AClass의 접근수준이 비공개 접근수준이므로
// 공개 접근수준 함수의 매개변수나 반환 값 타입으로 사용할 수 없습니다.
public func someFunction(a: AClass) -> AClass { // 오류 발생!
    return a
}
```

</br>

* 튜플의 내부 요소 타입 또한 튜플의 접근수준보다 같거나 높아야한다.
```swift
internal class InternalClass {} // 내부 접근수준 클래스
private struct PrivateStruct {} // 비공개 접근수준 구조체

// 요소로 사용되는 InternalClass와 PrivateStruct의 접근수준이
// publicTuple보다 낮기 때문에 사용할 수 없다.
public var publicTuple: (first: InternalClass, second: PrivateStruct) =
    ( InternalClass(), PrivateStruct() )
```

</br>

* 열거형의 접근 수준을 구현할 때는 각 case별로 따로 접근 수준을 부여할 수는 없다
* 열거형의 원시 값, 연관 값의 타입으로 열거형의 접근수준보다 낮은 접근수준의 타입이 올수 없다.

```swift
private typealias PointValue = Int

// 오류 - PointValue가 Point보다 접근수준이 낮기 때문에 원시 값으로 사용할 수 없다.
enum Point: PointValue {
    case x, y
}
```

</br>

## 5. private와 fileprivate
private 접근수준으로 지정한 요소는 같은 파일내부에 다른 타입의 코드가 있더라도 접근이 불가능하지만 extension 코드가 같은 파이레 존재하는 경우 접근 가능하다.

```swift
public struct SomeType {
    private var priavateVariable = 0
    fileprivate var fileprivateVariable = 0
}

// 같은 타입의 익스텐션에는 private요소에 접근 가능
extension SomeType {
    public func publicMethod() {
        print("\(self.priavateVariable), \(self.fileprivateVariable)")
    }
    
    private func privateMethod() {
        print("\(self.priavateVariable), \(self.fileprivateVariable)")
    }
    
    fileprivate func fileprivateMethod() {
        print("\(self.priavateVariable), \(self.fileprivateVariable)")
    }
    
}

struct AnotherType {
    var someInstance: SomeType = SomeType()
    
    mutating func someMethod() {
        // public 접근 수준에서는 어디서든 접근 가능
        self.someInstance.publicMethod()        // 0. 0
        
        // 같은 파일에 속해 있는 코드이므로 fileprivat 접근수준 요소에 접근 가능
        self.someInstance.fileprivateVariable = 100
        self.someInstance.fileprivateMethod()   // 0, 100
        
        // 다른 타입 내부의 코드이므로 private 요소에 접근 불가! 오류!
        // self.someInstance.privateVariable = 100
        // self.someInstance.privateMethod()
    }
}

var anotherInstance = AnotherType()
anotherInstance.someMethod()
```

</br>

## 6. 읽기 전용 구현

* 설정자(Setter)만 더 낮은 접근수준을 갖도록 제한한다.
* 요소의 접근수준 키워드 뒤에 (접근수준) (set) 처럼  표현하면 설정자의 접근수준만 더 낮도록 지정해줄 수 있다.
* 설정자 접근수준 제한은 프로퍼티, 서브스크립트, 변수 등에 적용될 수 있으며, 해당 요소의 접근수준보다 같거나 낮은 수준으로 제한해 주어야한다.

